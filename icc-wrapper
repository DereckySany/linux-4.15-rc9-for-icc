#!/bin/bash

ARGS="$@"
ICCARGS=""
for ARG in ${ARGS};
do
    case $ARG in
        -Wno-frame-address | -Wno-format-truncation | -Wno-format-overflow | -Wno-int-in-bool-context | -Wframe-larger-than=2048 | -Wno-unused-const-variable | -Wbad-function-cast | -Wformat-y2k | -Wnested-externs | -Wpacked | -Wredundant-decls | -Wswitch-default | -Wswitch-enum )
            # Safe
            ;;
        -mno-mmx | -mno-3dnow | -funit-at-a-time | -ggdb3 | -fconserve-stack )
            # Seems safe
            ;;
        -falign-jumps=1 )
            ICCARGS+=" -fno-align-loops"
            ;;
        -fno-stack-check )
            ICCARGS+=" -fno-stack-security-check"
            ;;
        -O6 )
            ICCARGS+=" -O3"
            ;;

        * )
            ICCARGS+=" $ARG"
            ;;
    esac
done

ICCARGS+=" -fno-strict-aliasing"
icc ${ICCARGS}
ret=$?

(( $ret == 0 )) && exit 0
echo ">>>>>icc-wrapper ${ARGS} <<<<<>>>>>icc ${ICCARGS} <<<<< failed with status $ret. Launching gcc..."  >> /tmp/fuck-icc.log && gcc ${ARGS}
exit $?
